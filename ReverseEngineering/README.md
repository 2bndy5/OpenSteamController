# Reverse Engineering

The work in this directory focuses on deconstructing the firmware and hardware
 of the Steam Controller. The understanding gained from this is the basis for
 the other work being done in this project. 


# Understanding the Hardware

See [Luna_maiboard_V000456-00_rev3.md](./Luna_maiboard_V000456-00_rev3.md) 
 for information regarding the Steam Controller hardware pertaining to 
 Luna_mainboard V000456-00 rev3.


# Understanding the Software

See [LPC11U37F_Software.md](./LPC11U37F_Software.md) for information regarding
 the software running on the LPC11U37 main/master processor.


# TODO

This section is a running list of priorities to focus on in hopes of reaching
 goal of modifying haptics jingle. This will be updated as tasks are completed
 and more knowledge is gained about the Steam Controller.

1. Questionable paths to dig into
    1. PIO0_3 status any different when configured to have pull down instead of pull-up?
1. Consider latest firmware update (new firmware to enable BLE for new Steam Link app)
    1. Look at what has changed?
    1. Will new tooling help to decompose the new firmware faster?
    1. Is this a distraction not worth digging into right now?
       1. Majority of functional behavior from vcf_wired_controller_d0g_57bf5c10.bin should remain unchanged (even if underlying assembly changes). 
       1. Once functionality is fully understood, applying that understanding to newer firmware may be quicker than "starting over" with new firmware?
1. Simulation to C Conversion
    1. Re-run everything using output of new pinkySim exeLog simplified C
    1. Run and decode non-straightforward paths
        1. Callbacks (need to understand hUsb stack details?)
            1. USB_Resume_Event at 0x00008de5
            1. USB_Configure_Event at 0x00004e59
            1. USB_Reset_Event at 0x00008d8b 
            1. USB_Suspend_Event at 0x0000995d 
            1. HID_GetReport at 0x00005af1
            1. HID_SetReport at 0x00009565
        1. Interrupts that have been enabled 
            1. PINT0 (interrupt generated by state change of PIO0_3/USB_VBUS)
    1. Continue running straightforward sim (with USB_VBUS = 1)
        1. Finish converting Left Haptic Init sim data
            1. Do SPI calls match up with lpc_chip_11uxx_lib?
                1. Can we use this to make simulation better or easier for SPI?
        1. What is coming next and why are we stalemating at wfi?
            1. Is sim taking a wrong/undesired path?
            1. Or is it the right path but we need another interrupt to kick us forward (i.e. USB to indicate we are connected and should play jingle...?)
                1. Note that connecting the controller just to USB power does not play jingle.
                1. Connecting controller to USB on computer does play jingle (but OS is communicating to enumerate USB device)
                1. But having USB_VBUS = 1 does play jingle...
                    1. Consider this path again? And look for LED pulse logic?
                1. And what about potential race condition of not having setup SPI?
                    1. Is state changed after setup?
                        1. Or maybe the I2C and SPI calls are more for shutdown/sleep...?
                    1. Is setup re-run regardless before jingle play?
    1. Questions to consider
        1. Where is path of communicating with nRF51822 wireless chip?
            1. How is communication with this achieved (USART)?
            1. Is USB simply inactive when wireless is used? But interrupt generated by USB_VBUS?
        1. USB_VBUS v.s. not(USB_CONNECT)?
            1. When is not(USB_CONNECT) used?
1. List more details about hardware [Luna_maiboard_V000456-00_rev3.md](./Luna_maiboard_V000456-00_rev3.md)
    1. Other processors (i.e. wireless comms chip, gyro, haptics chip)
    1. See if we can get information on each pin (focus on LPC chip)
    1. Add In/Out configuration column for pins?
    1. What is PIO1_7 connected to on hardware?
        1. Ohm it out!
    1. What is PIO0_19 connected to on hardware?
        1. Ohm it out!
1. Decompose EEPROM dumps
    1. Captured from two different controllers to isolate some differences
    1. Change settings to isolate other differences
1. How is communication occurring with radio chip?
1. Can we (continue to) make pinkySim logging better 
    1. More automation or second steps for cleaning .c log file?
